<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - GRUPO IT ARVIC</title>
    <link rel="stylesheet" href="../css/shared.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="admin-layout">
    <header class="admin-header">
        <nav class="navbar">
            <div class="logo">
                <img src="../images/Logo Grupo IT Arvic 33.svg" alt="GRUPO IT ARVIC" class="admin-logo-svg">
            </div>
            <div class="user-info">
                <span id="adminUserName">Hector Perez</span>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
            </div>
        </nav>
    </header>

    <main class="admin-content">
        <div class="container">
            <!-- Layout con Sidebar -->
            <div class="admin-layout-wrapper">
                <!-- Sidebar de Navegación -->
                <div class="admin-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">📊 Gestión General</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item active" data-section="usuarios">
                                <span class="menu-icon">👥</span>
                                <span class="menu-text">Usuarios</span>
                                <span class="menu-badge" id="sidebarUsersCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="empresas">
                                <span class="menu-icon">🏢</span>
                                <span class="menu-text">Empresas</span>
                                <span class="menu-badge" id="sidebarCompaniesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="proyectos">
                                <span class="menu-icon">📋</span>
                                <span class="menu-text">Proyectos</span>
                                <span class="menu-badge" id="sidebarProjectsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="soportes">
                                <span class="menu-icon">📞</span>
                                <span class="menu-text">Soportes</span>
                                <span class="menu-badge" id="sidebarSupportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="modulos">
                                <span class="menu-icon">🧩</span>
                                <span class="menu-text">Módulos</span>
                                <span class="menu-badge" id="sidebarModulesCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">🎯 Asignaciones</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="crear-asignacion">
                                <span class="menu-icon">➕</span>
                                <span class="menu-text">Asignar Soportes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="lista-asignaciones">
                                <span class="menu-icon">📋</span>
                                <span class="menu-text">Lista Completa</span>
                                <span class="menu-badge" id="sidebarAssignmentsCount">0</span>
                            </div>
                            
                            <div class="sidebar-menu-item" data-section="asignaciones-recientes">
                                <span class="menu-icon">🕒</span>
                                <span class="menu-text">Recientes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="asignar-proyectos">
                                <span class="menu-icon">🎯</span>
                                <span class="menu-text">Asignar Proyectos</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="lista-proyectos-asignados">
                                <span class="menu-icon">📋</span>
                                <span class="menu-text">Proyectos Asignados</span>
                                <span class="menu-badge" id="sidebarProjectAssignmentsCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">📄 Reportes</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="reportes-pendientes">
                                <span class="menu-icon">📊</span>
                                <span class="menu-text">Reportes Pendientes</span>
                                <span class="menu-badge" id="sidebarReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="reportes-aprobados">
                                <span class="menu-icon">✅</span>
                                <span class="menu-text">Reportes Aprobados</span>
                                <span class="menu-badge" id="sidebarApprovedReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="generar-reporte">
                                <span class="menu-icon">📋</span>
                                <span class="menu-text">Generar Reporte</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="historial-reportes">
                                <span class="menu-icon">📜</span>
                                <span class="menu-text">Historial Generados</span>
                                <span class="menu-badge" id="sidebarGeneratedReportsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido Principal -->
                <div class="admin-main-content">
                    <!-- Sección de Usuarios -->
                    <div id="usuarios-section" class="content-section active">
                        <div class="section-header">
                            <h2 class="section-title">👥 Gestión de Usuarios</h2>
                            <button class="add-btn" onclick="openUserModal()">+ Nuevo Usuario</button>
                        </div>
                        <div class="items-list" id="usersList">
                            <div class="empty-state">
                                <div class="empty-state-icon">👤</div>
                                <div class="empty-state-title">No hay usuarios</div>
                                <div class="empty-state-desc">Cree el primer usuario consultor</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Empresas -->
                    <div id="empresas-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">🏢 Gestión de Empresas</h2>
                            <button class="add-btn" onclick="openCompanyModal()">+ Nueva Empresa</button>
                        </div>
                        <div class="items-list" id="companiesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">🏢</div>
                                <div class="empty-state-title">No hay empresas</div>
                                <div class="empty-state-desc">Registre la primera empresa cliente</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Proyectos -->
                    <div id="proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📋 Gestión de Proyectos</h2>
                            <button class="add-btn" onclick="openProjectModal()">+ Nuevo Proyecto</button>
                        </div>
                        <div class="items-list" id="projectsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">📋</div>
                                <div class="empty-state-title">No hay proyectos</div>
                                <div class="empty-state-desc">Cree el primer proyecto</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Tareas -->
                    <div id="soportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📞 Gestión de Soportes</h2>
                            <button class="add-btn" onclick="openSupportModal()">+ Nuevo Soporte</button>
                        </div>
                        <div class="items-list" id="supportsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">📞</div>
                                <div class="empty-state-title">No hay soportes</div>
                                <div class="empty-state-desc">Cree el primer soporte</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Módulos -->
                    <div id="modulos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">🧩 Gestión de Módulos</h2>
                            <button class="add-btn" onclick="openModuleModal()">+ Nuevo Módulo</button>
                        </div>
                        <div class="items-list" id="modulesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">🧩</div>
                                <div class="empty-state-title">No hay módulos</div>
                                <div class="empty-state-desc">Cree el primer módulo</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Nueva Asignación -->
                    <div id="crear-asignacion-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">➕ Crear Nueva Asignación de Soporte</h2>
                        </div>
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <div class="form-group">
                                    <label for="assignUser">Usuario Consultor</label>
                                    <select id="assignUser" name="assignUser" required>
                                        <option value="">Seleccionar usuario</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignCompany">Empresa Cliente</label>
                                    <select id="assignCompany" name="assignCompany" required>
                                        <option value="">Seleccionar empresa</option>
                                    </select>
                                </div>
                                <!-- ✅ ELEMENTO CRÍTICO - ASEGURAR QUE ESTÉ EXACTAMENTE ASÍ -->
                                <div class="form-group">
                                    <label for="assignSupport">Soporte</label>
                                    <select id="assignSupport" name="assignSupport" required>
                                        <option value="">Seleccionar Soporte</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignModule">Módulos</label>
                                    <select id="assignModule" name="assignModule" required>
                                        <option value="">Seleccionar Módulo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createAssignment()">
                                    ➕ Crear Asignación
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Asignar Proyectos -->
                    <div id="asignar-proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">🎯 Asignar Proyecto a Consultor</h2>
                        </div>
                        
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <!-- Consultor -->
                                <div class="form-group">
                                    <label for="assignProjectConsultor">Consultor</label>
                                    <select id="assignProjectConsultor" name="assignProjectConsultor" required>
                                        <option value="">Seleccionar consultor</option>
                                    </select>
                                </div>
                                
                                <!-- Proyecto -->
                                <div class="form-group">
                                    <label for="assignProjectProject">Proyecto</label>
                                    <select id="assignProjectProject" name="assignProjectProject" required>
                                        <option value="">Seleccionar proyecto</option>
                                    </select>
                                </div>
                                
                                <!-- Empresa Cliente -->
                                <div class="form-group">
                                    <label for="assignProjectCompany">Empresa Cliente</label>
                                    <select id="assignProjectCompany" name="assignProjectCompany" required>
                                        <option value="">Seleccionar empresa cliente</option>
                                    </select>
                                </div>
                                
                                <!-- Módulo -->
                                <div class="form-group">
                                    <label for="assignProjectModule">Módulo</label>
                                    <select id="assignProjectModule" name="assignProjectModule" required>
                                        <option value="">Seleccionar módulo</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createProjectAssignment()">
                                    🎯 Asignar Proyecto
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📋 Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="assignments-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">🎯</div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecerán aquí</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Lista de Proyectos Asignados -->
                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📋 Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="project-assignments-container">
                            <div class="empty-state">
                                <div class="empty-state-icon">🎯</div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecerán aquí</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Lista de Asignaciones -->
                    <div id="lista-asignaciones-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📋 Lista Completa de Asignaciones</h2>
                        </div>
                        <div class="assignments-list" id="assignmentsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">🔗</div>
                                <div class="empty-state-title">No hay asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones creadas aparecerán en esta lista</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Asignaciones Recientes -->
                    <div id="asignaciones-recientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">🕒 Asignaciones Recientes</h2>
                        </div>
                        <div class="items-list" id="recentAssignments">
                            <div class="empty-state">
                                <div class="empty-state-icon">🎯</div>
                                <div class="empty-state-title">Sin asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones recientes aparecerán aquí</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Pendientes -->
                    <div id="reportes-pendientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📊 Reportes Pendientes</h2>
                        </div>
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="reportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>Tipo Soporte</th>
                                        <th>Módulo</th>
                                        <th>Horas Reportadas</th>
                                        <th>Fecha Reporte</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody">
                                    <tr>
                                        <td colspan="10" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📄</div>
                                                <div class="empty-state-title">No hay reportes</div>
                                                <div class="empty-state-desc">Los reportes enviados por consultores aparecerán aquí</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Aprobados -->
                    <div id="reportes-aprobados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">✅ Reportes Aprobados - Horas Acumuladas</h2>
                        </div>
                        
                        <!-- Filtros de Fecha -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="timeFilter">Filtrar por:</label>
                                <select id="timeFilter" onchange="updateApprovedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todas las Fechas</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="customDateRange" style="display: none;">
                                <label for="startDate">Fecha Inicio:</label>
                                <input type="date" id="startDate" onchange="updateApprovedReportsList()">
                                
                                <label for="endDate">Fecha Fin:</label>
                                <input type="date" id="endDate" onchange="updateApprovedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="filterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="approvedReportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>ID Cliente</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>Tipo Soporte</th>
                                        <th>Módulo</th>
                                        <th>Horas Acumuladas</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedReportsTableBody">
                                    <tr>
                                        <td colspan="8" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">✅</div>
                                                <div class="empty-state-title">No hay reportes aprobados</div>
                                                <div class="empty-state-desc">Los reportes aprobados aparecerán aquí con horas acumuladas</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Sección de Generar Reporte -->
                    <div id="generar-reporte-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📋 Generar Reportes</h2>
                        </div>
                        
                        <div class="report-generator">
                            <!-- Selector de Tipo de Reporte -->
                            <div class="report-type-selector">
                                <h3>Seleccionar Tipo de Reporte</h3>
                                <div class="report-type-options">
                                    <div class="report-type-card" onclick="selectReportType('actividades')">
                                        <div class="report-type-icon">📊</div>
                                        <h4>Reporte de Actividades</h4>
                                        <p>Reporte de horas trabajadas por consultor y asignación</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pagos')">
                                        <div class="report-type-icon">💰</div>
                                        <h4>Reporte de Pago Consultores</h4>
                                        <p>Reporte de pagos con tarifas editables por consultor</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pago_consultor_general')">
                                        <div class="report-type-icon">🏢</div>
                                            <h4>Pago Consultor (General)</h4>
                                            <p>Resumen de pagos consolidado para todos los consultores</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pago_consultor_individual')">
                                        <div class="report-type-icon">👤</div>
                                        <h4>Pago Consultor (Consultor)</h4>
                                        <p>Reporte de pagos individual para un consultor específico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('cliente_soporte')">
                                        <div class="report-type-icon">📞</div>
                                        <h4>Cliente Soporte</h4>
                                        <p>Reporte de servicios de soporte para un cliente específico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto')">
                                        <div class="report-type-icon">📋</div>
                                        <h4>Reporte Proyecto</h4>
                                        <p>Detalle de todos los consultores en un proyecto específico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto_cliente')">
                                        <div class="report-type-icon">🏢</div>
                                        <h4>Rep. Proyecto (Cliente)</h4>
                                        <p>Vista de proyectos orientada al cliente, agrupada por módulos</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto_consultor')">
                                        <div class="report-type-icon">👤</div>
                                        <h4>Rep. Proyecto (Consultor)</h4>
                                        <p>Reporte personal del consultor en proyecto específico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_remanente')">
                                        <div class="report-type-icon">📊</div>
                                        <h4>Reporte Remanente</h4>
                                        <p>Control matricial semanal de horas remanentes por módulo</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuración Reporte de Actividades -->
                            <div id="actividades-config" class="report-config" style="display: none;">
                                <h3>📊 Configuración - Reporte de Actividades</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label for="actividadesTimeFilter">Período:</label>
                                        <select id="actividadesTimeFilter">
                                            <option value="week">Esta Semana</option>
                                            <option value="month">Este Mes</option>
                                            <option value="custom">Rango Personalizado</option>
                                            <option value="all">Todas las Fechas</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group" id="actividadesCustomDateRange" style="display: none;">
                                        <label for="actividadesStartDate">Fecha Inicio:</label>
                                        <input type="date" id="actividadesStartDate">
                                        
                                        <label for="actividadesEndDate">Fecha Fin:</label>
                                        <input type="date" id="actividadesEndDate">
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" onclick="generateActividadesReport()">
                                            📊 Generar Reporte de Actividades
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="previewActividadesReport()">
                                            👁️ Vista Previa
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Vista Previa Actividades -->
                                <div id="actividadesPreview" class="report-preview" style="display: none;">
                                    <h4>Vista Previa - Reporte de Actividades</h4>
                                    <div class="preview-table-container">
                                        <table class="preview-table" id="actividadesPreviewTable">
                                            <thead>
                                                <tr>
                                                    <th>ID Consultor</th>
                                                    <th>Nombre Consultor</th>
                                                    <th>ID Cliente</th>
                                                    <th>Cliente (Empresa)</th>
                                                    <th>Proyecto</th>
                                                    <th>Tarea</th>
                                                    <th>Módulo</th>
                                                    <th>Horas Totales</th>
                                                </tr>
                                            </thead>
                                            <tbody id="actividadesPreviewBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuración Reporte de Pagos -->
                            <div id="pagos-config" class="report-config" style="display: none;">
                                <h3>💰 Configuración - Reporte de Pago Consultores</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label for="pagosTimeFilter">Período:</label>
                                        <select id="pagosTimeFilter">
                                            <option value="week">Esta Semana</option>
                                            <option value="month">Este Mes</option>
                                            <option value="custom">Rango Personalizado</option>
                                            <option value="all">Todas las Fechas</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group" id="pagosCustomDateRange" style="display: none;">
                                        <label for="pagosStartDate">Fecha Inicio:</label>
                                        <input type="date" id="pagosStartDate">
                                        
                                        <label for="pagosEndDate">Fecha Fin:</label>
                                        <input type="date" id="pagosEndDate">
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosConfiguration()">
                                            🔧 Configurar Tarifas y Generar
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Configuración de Tarifas -->
                                <div id="pagosConfiguration" class="pagos-configuration" style="display: none;">
                                    <h4>Configuración de Tarifas por Consultor</h4>
                                    <div class="tariff-info">
                                        <p><strong>Instrucciones:</strong> Ajuste las horas y tarifas por consultor. El total se calculará automáticamente.</p>
                                    </div>
                                    <div class="tariff-table-container">
                                        <table class="tariff-table" id="tariffConfigTable">
                                            <thead>
                                                <tr>
                                                    <th>ID Consultor</th>
                                                    <th>Nombre Consultor</th>
                                                    <th>Cliente</th>
                                                    <th>Proyecto</th>
                                                    <th>Horas Reportadas</th>
                                                    <th>Horas Ajustadas</th>
                                                    <th>Tarifa por Hora ($)</th>
                                                    <th>Total ($)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tariffConfigBody"></tbody>
                                        </table>
                                    </div>
                                    <div class="tariff-actions">
                                        <button type="button" class="btn btn-success" onclick="generatePagosReport()">
                                            💰 Generar Reporte Final de Pagos
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="resetTariffs()">
                                            🔄 Restablecer Tarifas
                                        </button>
                                    </div>
                                    <div class="tariff-summary">
                                        <div class="summary-item">
                                            <strong>Total Horas: <span id="totalHours">0</span></strong>
                                        </div>
                                        <div class="summary-item">
                                            <strong>Total a Pagar: $<span id="totalAmount">0.00</span></strong>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuración Pago Consultor General -->
                            <div id="pago-consultor-general-config" class="report-config" style="display: none;">
                                <h3>🏢 Configuración - Pago Consultor (General)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte consolida los pagos de todos los consultores en todas las empresas. Las horas y tarifas son editables antes de generar el Excel.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosGeneralConfiguration()">
                                            📊 Generar Vista Previa
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainer">
                                    <!-- Aquí se carga la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Pago Consultor Individual -->
                            <div id="pago-consultor-individual-config" class="report-config" style="display: none;">
                                <h3>👤 Configuración - Pago Consultor (Individual)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte muestra los pagos de un consultor específico. Primero deberá seleccionar el consultor y luego las horas y tarifas serán editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosIndividualConfiguration()">
                                            👤 Seleccionar Consultor
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerIndividual">
                                    <!-- Aquí se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Cliente Soporte -->
                            <div id="cliente-soporte-config" class="report-config" style="display: none;">
                                <h3>📞 Configuración - Cliente Soporte</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte muestra los servicios de soporte por módulo para un cliente específico. Primero deberá seleccionar el cliente y luego las horas y tarifas serán editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadClienteSoporteConfiguration()">
                                            👤 Seleccionar Cliente
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerSoporte">
                                    <!-- Aquí se carga el selector de cliente y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Reporte Proyecto -->
                            <div id="reporte-proyecto-config" class="report-config" style="display: none;">
                                <h3>📋 Configuración - Reporte Proyecto</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte muestra todos los consultores trabajando en un proyecto específico. Primero deberá seleccionar el proyecto y luego las horas y tarifas serán editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadReporteProyectoConfiguration()">
                                            📋 Seleccionar Proyecto
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyecto">
                                    <!-- Aquí se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Reporte Proyecto (Cliente) -->
                            <div id="reporte-proyecto-cliente-config" class="report-config" style="display: none;">
                                <h3>🏢 Configuración - Rep. Proyecto (Cliente)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte muestra los proyectos trabajados para un cliente específico, agrupados por módulos. Ideal para presentación externa al cliente.</p>
                                    </div>
                                    <div class="form-group" style="text-align: center;">
                                    <button type="button" class="btn btn-primary" onclick="loadReporteProyectoClienteConfiguration()">
                                        🏢 Seleccionar Cliente
                                    </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyectoCliente">
                                    <!-- Aquí se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Reporte Proyecto (Consultor) -->
                            <div id="reporte-proyecto-consultor-config" class="report-config" style="display: none;">
                                <h3>👤 Configuración - Rep. Proyecto (Consultor)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este reporte muestra el trabajo individual de un consultor específico en un proyecto particular. Ideal para evaluaciones de desempeño y reportes personales.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadReporteProyectoConsultorConfiguration()">
                                            👤 Seleccionar Consultor
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyectoConsultor">
                                    <!-- Aquí se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuración Reporte Remanente -->
                            <div id="reporte-remanente-config" class="report-config" style="display: none;">
                                <h3>📊 Configuración - Reporte Remanente</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Información:</label>
                                        <p class="config-info">Este es el reporte más complejo del sistema. Muestra una matriz semanal de horas remanentes por módulo en un período mensual específico. Las semanas se calculan automáticamente según los días del mes.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadRemanenteConfiguration()">
                                            📊 Configurar Reporte Remanente
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerRemanente">
                                    <!-- Aquí se carga el selector y la matriz editable -->
                                </div>
                            </div>

                            <!-- Opciones Generales -->
                            <div class="report-options">
                                <h3>Opciones Generales</h3>
                                <div class="form-group">
                                    <button type="button" class="btn btn-secondary" onclick="exportData()">
                                        💾 Exportar Datos Completos
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="importData()">
                                        📁 Importar Datos
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="generateAdminReport()">
                                        📋 Reporte Administrativo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Historial de Reportes Generados -->
                    <div id="historial-reportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">📜 Historial de Reportes Generados</h2>
                            <button class="add-btn" onclick="refreshGeneratedReportsList()">🔄 Actualizar</button>
                        </div>
                        
                        <!-- Filtros para Historial -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="historialTimeFilter">Período:</label>
                                <select id="historialTimeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todos los Reportes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="historialTypeFilter">Tipo:</label>
                                <select id="historialTypeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="all">Todos los Tipos</option>
                                    <option value="actividades">Reportes de Actividades</option>
                                    <option value="pagos">Reportes de Pagos</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="historialCustomDateRange" style="display: none;">
                                <label for="historialStartDate">Fecha Inicio:</label>
                                <input type="date" id="historialStartDate" onchange="updateGeneratedReportsList()">
                                
                                <label for="historialEndDate">Fecha Fin:</label>
                                <input type="date" id="historialEndDate" onchange="updateGeneratedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="historialFilterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        

                        <!-- Tabla de Reportes Generados -->
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="generatedReportsTable">
                                <thead>
                                    <tr>
                                        <th>Nombre del Archivo</th>
                                        <th>Tipo de Reporte</th>
                                        <th>Período</th>
                                        <th>Registros</th>
                                        <th>Horas Totales</th>
                                        <th>Monto Total</th>
                                        <th>Fecha Generación</th>
                                        <th>Descargas</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="generatedReportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">📊</div>
                                                <div class="empty-state-title">No hay reportes generados</div>
                                                <div class="empty-state-desc">Los reportes Excel generados aparecerán en este historial</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Estadísticas del Historial -->
                        <div class="historial-stats">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalGeneratedReports">0</div>
                                    <div class="stat-label">Total Reportes</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalActividadReports">0</div>
                                    <div class="stat-label">Rep. Actividades</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalPagoReports">0</div>
                                    <div class="stat-label">Rep. Pagos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalDownloads">0</div>
                                    <div class="stat-label">Total Descargas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Usuario -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">👤 Crear Nuevo Usuario</h2>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm" class="admin-form">
                    <div class="form-group">
                        <label for="userName">Nombre Completo *</label>
                        <input type="text" id="userName" placeholder="Ej: Juan Pérez García" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email (opcional)</label>
                        <input type="email" id="userEmail" placeholder="juan.perez@empresa.com">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Usuario</button>
                    </div>
                </form>
                <div class="message message-info">
                    <strong>Información:</strong> El sistema generará automáticamente un ID único y una contraseña temporal para el nuevo usuario.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🏢 Registrar Nueva Empresa</h2>
                <button class="close" onclick="closeModal('companyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="companyForm" class="admin-form">
                    <div class="form-group">
                        <label for="companyName">Nombre de la Empresa *</label>
                        <input type="text" id="companyName" placeholder="Ej: Tecnología Avanzada SA de CV" required>
                    </div>
                    <div class="form-group">
                        <label for="companyDescription">Descripción (opcional)</label>
                        <textarea id="companyDescription" placeholder="Breve descripción de la empresa y sus servicios" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Registrar Empresa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Proyecto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📋 Crear Nuevo Proyecto</h2>
                <button class="close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm" class="admin-form">
                    <div class="form-group">
                        <label for="projectName">Nombre del Proyecto *</label>
                        <input type="text" id="projectName" placeholder="Ej: Sistema de Gestión Empresarial" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Descripción (opcional)</label>
                        <textarea id="projectDescription" placeholder="Descripción detallada del proyecto" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectStatus">Estado del Proyecto</label>
                        <select id="projectStatus">
                            <option value="Planificación">Planificación</option>
                            <option value="En Progreso" selected>En Progreso</option>
                            <option value="En Pausa">En Pausa</option>
                            <option value="Completado">Completado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Proyecto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Soporte -->
    <div id="supportModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">📞 Crear Nuevo Soporte</h2>
            <button class="close" onclick="closeModal('supportModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="supportForm" class="admin-form">
                <div class="form-group">
                    <label for="supportName">Nombre del Soporte *</label>
                    <input type="text" id="supportName" placeholder="Ej: Soporte técnico sistema ERP" required>
                </div>
                <div class="form-group">
                    <label for="supportDescription">Descripción (opcional)</label>
                    <textarea id="supportDescription" placeholder="Descripción detallada del soporte" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="supportPriority">Prioridad</label>
                    <select id="supportPriority">
                        <option value="Baja">Baja</option>
                        <option value="Media" selected>Media</option>
                        <option value="Alta">Alta</option>
                        <option value="Crítica">Crítica</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportType">Tipo de Soporte</label>
                    <select id="supportType">
                        <option value="Técnico">Técnico</option>
                        <option value="Funcional">Funcional</option>
                        <option value="Configuración">Configuración</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Crear Soporte</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal Módulo -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🧩 Crear Nuevo Módulo</h2>
                <button class="close" onclick="closeModal('moduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="moduleForm" class="admin-form">
                    <div class="form-group">
                        <label for="moduleName">Nombre del Módulo *</label>
                        <input type="text" id="moduleName" placeholder="Ej: Módulo MM" required>
                    </div>
                    <div class="form-group">
                        <label for="moduleDescription">Descripción (opcional)</label>
                        <textarea id="moduleDescription" placeholder="Descripción detallada del módulo" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Módulo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
<script src="../js/database.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/utils.js"></script>
<script src="js/pago-consultor-general.js"></script>
<script src="js/pago-consultor-individual.js"></script>
<script src="js/cliente-soporte.js"></script>
<script src="js/reporte-proyecto.js"></script>
<script src="js/reporte-proyecto-cliente.js"></script>
<script src="js/reporte-proyecto-consultor.js"></script>
<script src="js/reporte-remanente.js"></script>
<script src="admin.js"></script>
</body>
</html>